- content_for :page_title do
  = t('admin.gamepatch.payments.subscriptions_title')

- content_for :heading_actions do
  = form_tag admin_gamepatch_payments_subscriptions_path, method: :get, class: 'simple_form' do
    .fields-row
      .fields-row__column
        = select_tag :status, options_for_select([['All Statuses', ''], ['Active', 'active'], ['Pending', 'pending'], ['Cancelled', 'cancelled'], ['Expired', 'expired']], params[:status])
      .fields-row__column
        = select_tag :tier, options_for_select([['All Tiers', ''], ['Bronze', 'bronze'], ['Silver', 'silver'], ['Gold', 'gold']], params[:tier])
      .fields-row__column
        = button_tag t('admin.gamepatch.payments.filter'), type: 'submit', class: 'button'

.table-wrapper
  %table.table
    %thead
      %tr
        %th= t('admin.gamepatch.payments.id')
        %th= t('admin.gamepatch.payments.account')
        %th= t('admin.gamepatch.payments.tier')
        %th= t('admin.gamepatch.payments.status')
        %th= t('admin.gamepatch.payments.amount')
        %th= t('admin.gamepatch.payments.period_end')
        %th= t('admin.gamepatch.payments.created')
        %th
    %tbody
      - @subscriptions.each do |subscription|
        %tr
          %td= subscription.id
          %td
            - if subscription.account
              = link_to subscription.account.username, admin_account_path(subscription.account_id)
            - else
              %em N/A
          %td
            - tier_config = ::Gamepatch::MollieService::TIERS[subscription.tier]
            = tier_config&.dig(:badge)
            = subscription.tier.titleize
          %td
            %span.indicator-icon{ class: subscription.active? ? 'success' : (subscription.cancelled? ? 'failure' : nil) }
            = subscription.status
          %td= number_to_currency(subscription.amount, unit: "\u20AC")
          %td
            - if subscription.current_period_end
              = l(subscription.current_period_end, format: :short)
            - else
              \-
          %td= l(subscription.created_at, format: :short)
          %td
            = link_to t('admin.gamepatch.payments.view'), admin_gamepatch_payments_subscription_path(subscription), class: 'button button-secondary'

= paginate @subscriptions
