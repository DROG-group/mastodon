- content_for :page_title do
  = t('admin.gamepatch.dashboard.title')

.dashboard
  .dashboard__item
    .dashboard__quick-access.dashboard__quick-access--yellow
      %span= t('admin.gamepatch.dashboard.total_widgets')
      %strong= @stats[:total_widgets]

  .dashboard__item
    .dashboard__quick-access.dashboard__quick-access--yellow
      %span= t('admin.gamepatch.dashboard.total_responses')
      %strong= @stats[:total_responses]

  .dashboard__item
    .dashboard__quick-access.dashboard__quick-access--yellow
      %span= t('admin.gamepatch.dashboard.total_impressions')
      %strong= @stats[:total_impressions]

  .dashboard__item
    .dashboard__quick-access.dashboard__quick-access--yellow
      %span= t('admin.gamepatch.dashboard.active_api_keys')
      %strong= @stats[:active_api_keys]

%hr.spacer

%h3= t('admin.gamepatch.dashboard.widget_distribution')

.simple_form
  - @widget_type_distribution.each do |type, count|
    .batch-table__row
      .batch-table__row__content
        %span.batch-table__row__content__extra= type
        %span.batch-table__row__content__text= count

%hr.spacer

%h3= t('admin.gamepatch.dashboard.recent_widgets')

.table-wrapper
  %table.table
    %thead
      %tr
        %th= t('admin.gamepatch.widgets.uid')
        %th= t('admin.gamepatch.widgets.type')
        %th= t('admin.gamepatch.widgets.prompt')
        %th= t('admin.gamepatch.widgets.responses')
        %th= t('admin.gamepatch.widgets.created')
    %tbody
      - @recent_widgets.each do |widget|
        %tr
          %td
            %code= widget.uid
          %td= widget.widget_type
          %td= truncate(widget.prompt, length: 50)
          %td= widget.responses_count
          %td= l(widget.created_at)

- if @stats[:recent_imports].any?
  %hr.spacer

  %h3= t('admin.gamepatch.dashboard.recent_imports')

  .table-wrapper
    %table.table
      %thead
        %tr
          %th= t('admin.gamepatch.imports.type')
          %th= t('admin.gamepatch.imports.source')
          %th= t('admin.gamepatch.imports.status')
          %th= t('admin.gamepatch.imports.records')
          %th= t('admin.gamepatch.imports.date')
      %tbody
        - @stats[:recent_imports].each do |log|
          %tr
            %td= log.import_type
            %td= truncate(log.source_name, length: 30)
            %td
              %span.indicator-icon{ class: log.status == 'completed' ? 'success' : (log.status == 'failed' ? 'failure' : nil) }
                = material_symbol(log.status == 'completed' ? 'check' : (log.status == 'failed' ? 'close' : 'pending'))
              = log.status
            %td= "#{log.success_count}/#{log.total_records}"
            %td= l(log.created_at)
