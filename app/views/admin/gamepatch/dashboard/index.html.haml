- content_for :page_title do
  = t(admin.gamepatch.dashboard.title)

- content_for :heading do
  .content__heading__row
    %h2
      %span.content__heading__icon
        = material_symbol widgets
      = t(admin.gamepatch.dashboard.title)

.dashboard
  .dashboard__item
    .dashboard__quick-access.dashboard__quick-access--yellow
      %span= t(admin.gamepatch.dashboard.total_cards)
      %strong= @stats[:total_cards]

  .dashboard__item
    .dashboard__quick-access.dashboard__quick-access--yellow
      %span= t(admin.gamepatch.dashboard.total_instances)
      %strong= @stats[:total_instances]

  .dashboard__item
    .dashboard__quick-access.dashboard__quick-access--yellow
      %span= t(admin.gamepatch.dashboard.total_responses)
      %strong= @stats[:total_responses]

  .dashboard__item
    .dashboard__quick-access.dashboard__quick-access--yellow
      %span= t(admin.gamepatch.dashboard.active_bots)
      %strong= @stats[:active_bots]

  .dashboard__item
    .dashboard__quick-access.dashboard__quick-access--yellow
      %span= t(admin.gamepatch.dashboard.active_api_keys)
      %strong= @stats[:active_api_keys]

%hr.spacer

%h3= t(admin.gamepatch.dashboard.schema_distribution)

.simple_form
  - @schema_distribution.each do |version, count|
    .batch-table__row
      .batch-table__row__content
        %span.batch-table__row__content__extra= version
        %span.batch-table__row__content__text= count

%hr.spacer

%h3= t(admin.gamepatch.dashboard.recent_cards)

.table-wrapper
  %table.table
    %thead
      %tr
        %th= t(admin.gamepatch.cards.uid)
        %th= t(admin.gamepatch.cards.schema_version)
        %th= t(admin.gamepatch.cards.card_version)
        %th= t(admin.gamepatch.cards.title)
        %th= t(admin.gamepatch.cards.instances)
        %th= t(admin.gamepatch.cards.created)
    %tbody
      - @recent_cards.each do |card|
        %tr
          %td
            %code= card.uid
          %td= card.schema_version
          %td= card.card_version
          %td= truncate(card.definition&.dig(title).to_s, length: 50)
          %td= @instance_counts[card.id] || 0
          %td= l(card.created_at)

- if @stats[:recent_imports].any?
  %hr.spacer

  %h3= t(admin.gamepatch.dashboard.recent_imports)

  .table-wrapper
    %table.table
      %thead
        %tr
          %th= t(admin.gamepatch.imports.type)
          %th= t(admin.gamepatch.imports.source)
          %th= t(admin.gamepatch.imports.status)
          %th= t(admin.gamepatch.imports.records)
          %th= t(admin.gamepatch.imports.date)
      %tbody
        - @stats[:recent_imports].each do |log|
          - status_class = if log.status == completed
              success
            elsif log.status == failed
              failure
            end
          - status_icon = if log.status == completed
              check
            elsif log.status == failed
              close
            else
              pending
            end
          %tr
            %td= log.import_type
            %td= truncate(log.source_name, length: 30)
            %td
              %span.indicator-icon{ class: status_class }
                = material_symbol(status_icon)
              = log.status
            %td #{log.success_count}/#{log.total_records}
            %td= l(log.created_at)
