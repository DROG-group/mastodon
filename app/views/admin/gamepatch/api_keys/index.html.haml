- content_for :page_title do
  = t('admin.gamepatch.api_keys.title')

- if flash[:new_token]
  .flash-message.notice
    %strong= t('admin.gamepatch.api_keys.copy_token')
    %pre
      %code= flash[:new_token]

.simple_form
  %h3= t('admin.gamepatch.api_keys.generate_new')
  = form_tag admin_gamepatch_api_keys_path, method: :post, class: 'simple_form' do
    .fields-group
      .input.string.required
        = label_tag :name, t('admin.gamepatch.api_keys.name')
        = text_field_tag :name, nil, placeholder: t('admin.gamepatch.api_keys.name_placeholder')

    .fields-group
      .input.check_boxes
        = label_tag nil, t('admin.gamepatch.api_keys.scopes')
        - Gamepatch::ApiKey::SCOPES.each do |scope|
          %label.checkbox
            = check_box_tag 'scopes[]', scope
            = scope.humanize

    .actions
      = button_tag t('admin.gamepatch.api_keys.generate'), type: 'submit', class: 'button'

%hr.spacer

%h3= t('admin.gamepatch.api_keys.existing_keys')

- if @api_keys.empty?
  %p.hint= t('admin.gamepatch.api_keys.no_keys')
- else
  .table-wrapper
    %table.table
      %thead
        %tr
          %th= t('admin.gamepatch.api_keys.name')
          %th= t('admin.gamepatch.api_keys.prefix')
          %th= t('admin.gamepatch.api_keys.scopes')
          %th= t('admin.gamepatch.api_keys.created_by')
          %th= t('admin.gamepatch.api_keys.last_used')
          %th= t('admin.gamepatch.api_keys.status')
          %th
      %tbody
        - @api_keys.each do |key|
          %tr{ class: key.revoked? ? 'batch-table__row--muted' : nil }
            %td= key.name
            %td
              %code= key.display_prefix
            %td= key.scopes.join(', ')
            %td= key.created_by_account&.username || '-'
            %td= key.last_used_at ? l(key.last_used_at) : t('admin.gamepatch.api_keys.never')
            %td
              - if key.revoked?
                %span.indicator-icon.failure
                  = material_symbol('close')
                = t('admin.gamepatch.api_keys.revoked_status')
              - else
                %span.indicator-icon.success
                  = material_symbol('check')
                = t('admin.gamepatch.api_keys.active_status')
            %td
              - unless key.revoked?
                = button_to t('admin.gamepatch.api_keys.revoke'), admin_gamepatch_api_key_path(key), method: :delete, class: 'button button--destructive', data: { confirm: t('admin.gamepatch.api_keys.revoke_confirm') }

%hr.spacer

%h3= t('admin.gamepatch.api_keys.usage')
%p.hint= t('admin.gamepatch.api_keys.usage_hint')
%pre
  %code
    :preserve
      curl -H "X-Gamepatch-Admin-Key: gp_your_token_here" \\
        https://your-domain.com/gamepatch/admin/analytics.json
